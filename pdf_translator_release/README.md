# PDF æ‰¹é‡ç¿»è¯‘å·¥å…·

ä¸€ä¸ªå¼ºå¤§çš„ Python å·¥å…·ï¼Œç”¨äºæ‰¹é‡ç¿»è¯‘è‹±æ–‡ PDF è®ºæ–‡ä¸ºä¸­æ–‡ï¼Œæ”¯æŒ AI é©±åŠ¨çš„é«˜è´¨é‡ç¿»è¯‘ï¼Œè‡ªåŠ¨å¤„ç†é•¿æ–‡æ¡£ï¼Œä¿ç•™æ ¼å¼å’Œå…¬å¼ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

âœ… **æ‰¹é‡å¤„ç†** - è‡ªåŠ¨æ‰«æç›®å½•ä¸‹æ‰€æœ‰ PDF æ–‡ä»¶å¹¶æ‰¹é‡ç¿»è¯‘  
âœ… **æ™ºèƒ½åˆ†å—** - è‡ªåŠ¨å°†é•¿æ–‡æ¡£åˆ†å—å¤„ç†ï¼Œé¿å… AI token é™åˆ¶  
âœ… **ä¸Šä¸‹æ–‡ä¿æŒ** - åˆ†å—ç¿»è¯‘æ—¶ä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§  
âœ… **æ ¼å¼ä¿ç•™** - å°½å¯èƒ½ä¿ç•™åŸæ–‡æ¡£çš„æ ‡é¢˜ã€æ®µè½ç»“æ„  
âœ… **å…¬å¼ä¿æŠ¤** - è¯†åˆ«å¹¶ä¿ç•™ LaTeX æ•°å­¦å…¬å¼  
âœ… **æ–­ç‚¹ç»­ä¼ ** - æ”¯æŒç¼“å­˜æœºåˆ¶ï¼Œç¿»è¯‘ä¸­æ–­å¯ç»§ç»­  
âœ… **è¿›åº¦è·Ÿè¸ª** - å®æ—¶æ˜¾ç¤ºç¿»è¯‘è¿›åº¦å’Œæ—¥å¿—è®°å½•  
âœ… **é”™è¯¯é‡è¯•** - è‡ªåŠ¨é‡è¯•å¤±è´¥çš„ API è°ƒç”¨  
âœ… **å¤š API æ”¯æŒ** - æ”¯æŒ DeepSeekã€OpenAI ç­‰å…¼å®¹ API

## ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- æ“ä½œç³»ç»Ÿï¼šLinux / macOS / Windows
- ä¾èµ–åº“ï¼šPyMuPDF, pdfplumber, openai, reportlab

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®

```bash
cd /path/to/your/workspace
# å¦‚æœå·²æœ‰é¡¹ç›®æ–‡ä»¶ï¼Œç›´æ¥è¿›å…¥ç›®å½•
cd pdf_translator
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install pymupdf pdfplumber openai reportlab python-dotenv
```

### 3. å®‰è£…ä¸­æ–‡å­—ä½“ï¼ˆLinuxï¼‰

```bash
sudo apt-get update
sudo apt-get install fonts-wqy-microhei fonts-wqy-zenhei
```

macOS å’Œ Windows é€šå¸¸å·²åŒ…å«ä¸­æ–‡å­—ä½“ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚

## é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ï¼š`config.json`

åœ¨ä½¿ç”¨å‰ï¼Œéœ€è¦é…ç½® API å¯†é’¥å’Œç¿»è¯‘å‚æ•°ï¼š

```json
{
  "api": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "api_key": "YOUR_API_KEY_HERE",
    "base_url": "https://api.deepseek.com",
    "max_tokens": 4000,
    "temperature": 0.3
  },
  "translation": {
    "source_lang": "en",
    "target_lang": "zh",
    "chunk_size": 2500,
    "preserve_formulas": true,
    "preserve_images": true,
    "context_overlap": 200
  },
  "output": {
    "suffix": "_chn",
    "format": "pdf",
    "keep_original_layout": true
  },
  "processing": {
    "max_concurrent": 1,
    "retry_times": 3,
    "retry_delay": 2,
    "cache_enabled": true
  }
}
```

### é…ç½®é¡¹è¯´æ˜

#### API é…ç½® (`api`)

- **provider**: API æä¾›å•†ï¼ˆ`deepseek` / `openai`ï¼‰
- **model**: ä½¿ç”¨çš„æ¨¡å‹åç§°
  - DeepSeek: `deepseek-chat`
  - OpenAI: `gpt-4`, `gpt-3.5-turbo` ç­‰
- **api_key**: API å¯†é’¥ï¼ˆå¿…å¡«ï¼‰
- **base_url**: API åŸºç¡€ URL
  - DeepSeek: `https://api.deepseek.com`
  - OpenAI: ç•™ç©ºæˆ– `https://api.openai.com/v1`
- **max_tokens**: æœ€å¤§ç”Ÿæˆ token æ•°
- **temperature**: ç”Ÿæˆæ¸©åº¦ï¼ˆ0-1ï¼Œè¶Šä½è¶Šç¡®å®šï¼‰

#### ç¿»è¯‘é…ç½® (`translation`)

- **source_lang**: æºè¯­è¨€ä»£ç ï¼ˆ`en` = è‹±æ–‡ï¼‰
- **target_lang**: ç›®æ ‡è¯­è¨€ä»£ç ï¼ˆ`zh` = ä¸­æ–‡ï¼‰
- **chunk_size**: æ¯ä¸ªæ–‡æœ¬å—çš„æœ€å¤§å­—ç¬¦æ•°
- **preserve_formulas**: æ˜¯å¦ä¿ç•™æ•°å­¦å…¬å¼
- **preserve_images**: æ˜¯å¦ä¿ç•™å›¾ç‰‡
- **context_overlap**: å—ä¹‹é—´çš„ä¸Šä¸‹æ–‡é‡å å­—ç¬¦æ•°

#### è¾“å‡ºé…ç½® (`output`)

- **suffix**: è¾“å‡ºæ–‡ä»¶ååç¼€ï¼ˆé»˜è®¤ `_chn`ï¼‰
- **format**: è¾“å‡ºæ ¼å¼ï¼ˆç›®å‰ä»…æ”¯æŒ `pdf`ï¼‰
- **keep_original_layout**: æ˜¯å¦å°½é‡ä¿æŒåŸå§‹å¸ƒå±€

#### å¤„ç†é…ç½® (`processing`)

- **max_concurrent**: æœ€å¤§å¹¶å‘å¤„ç†æ•°ï¼ˆå»ºè®®è®¾ä¸º 1ï¼‰
- **retry_times**: API è°ƒç”¨å¤±è´¥é‡è¯•æ¬¡æ•°
- **retry_delay**: é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
- **cache_enabled**: æ˜¯å¦å¯ç”¨ç¼“å­˜

### ç¯å¢ƒå˜é‡æ–¹å¼é…ç½®ï¼ˆæ¨èï¼‰

ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½® API Keyï¼š

```bash
# ä½¿ç”¨ DeepSeek
export DEEPSEEK_API_KEY="your_deepseek_api_key"

# æˆ–ä½¿ç”¨ OpenAI
export OPENAI_API_KEY="your_openai_api_key"
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
python translate_pdfs.py <PDFç›®å½•è·¯å¾„>
```

### ç¤ºä¾‹

#### 1. ç¿»è¯‘å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ PDF

```bash
python translate_pdfs.py ./papers/
```

#### 2. é€’å½’ç¿»è¯‘å­ç›®å½•ä¸­çš„ PDF

```bash
python translate_pdfs.py ./papers/ -r
```

#### 3. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```bash
python translate_pdfs.py ./papers/ -c my_config.json
```

#### 4. å®Œæ•´ç¤ºä¾‹

```bash
# è®¾ç½® API Key
export DEEPSEEK_API_KEY="sk-xxxxxxxxxxxxx"

# ç¿»è¯‘æŒ‡å®šç›®å½•
python translate_pdfs.py ~/Documents/research_papers/ -r

# ç¿»è¯‘ç»“æœå°†ä¿å­˜ä¸ºï¼š
# åŸæ–‡ä»¶: paper1.pdf â†’ ç¿»è¯‘: paper1_chn.pdf
# åŸæ–‡ä»¶: paper2.pdf â†’ ç¿»è¯‘: paper2_chn.pdf
```

### å‘½ä»¤è¡Œå‚æ•°

```
usage: translate_pdfs.py [-h] [-r] [-c CONFIG] [-v] directory

æ‰¹é‡ç¿»è¯‘ PDF è®ºæ–‡å·¥å…·

positional arguments:
  directory             åŒ…å« PDF æ–‡ä»¶çš„ç›®å½•è·¯å¾„

optional arguments:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -r, --recursive       é€’å½’å¤„ç†å­ç›®å½•ä¸­çš„ PDF æ–‡ä»¶
  -c CONFIG, --config CONFIG
                        é…ç½®æ–‡ä»¶è·¯å¾„ (é»˜è®¤: config.json)
  -v, --version         æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

## å·¥ä½œæµç¨‹

1. **æ‰«æç›®å½•** - æŸ¥æ‰¾æ‰€æœ‰ PDF æ–‡ä»¶ï¼ˆè·³è¿‡å·²ç¿»è¯‘çš„ `*_chn.pdf`ï¼‰
2. **æå–æ–‡æœ¬** - ä½¿ç”¨ pdfplumber å’Œ PyMuPDF æå–æ–‡æœ¬å†…å®¹
3. **æ™ºèƒ½åˆ†å—** - æŒ‰æ®µè½å’Œå¤§å°å°†æ–‡æœ¬åˆ†æˆå¤šä¸ªå—
4. **è°ƒç”¨ AI ç¿»è¯‘** - é€å—è°ƒç”¨ AI API è¿›è¡Œç¿»è¯‘
5. **ç”Ÿæˆ PDF** - å°†ç¿»è¯‘ç»“æœç”Ÿæˆæ–°çš„ PDF æ–‡ä»¶
6. **ä¿å­˜æ—¥å¿—** - è®°å½•å¤„ç†è¿‡ç¨‹å’Œç»“æœ

## è¾“å‡ºè¯´æ˜

### æ–‡ä»¶å‘½å

- åŸæ–‡ä»¶ï¼š`research_paper.pdf`
- ç¿»è¯‘æ–‡ä»¶ï¼š`research_paper_chn.pdf`ï¼ˆé»˜è®¤åç¼€ `_chn`ï¼‰

### æ—¥å¿—æ–‡ä»¶

æ¯æ¬¡è¿è¡Œä¼šåœ¨ç›®æ ‡ç›®å½•ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼š

```
translation_log_20231023_143022.txt
```

æ—¥å¿—å†…å®¹åŒ…æ‹¬ï¼š
- å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- é”™è¯¯ä¿¡æ¯
- å¤„ç†æ—¶é—´

### ç¼“å­˜æœºåˆ¶

ç¿»è¯‘ç»“æœä¼šç¼“å­˜åœ¨ `.cache/` ç›®å½•ä¸‹ï¼Œå¦‚æœç¿»è¯‘ä¸­æ–­ï¼Œé‡æ–°è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é‡å¤ç¿»è¯‘ã€‚

## å¸¸è§é—®é¢˜

### 1. API Key é…ç½®é—®é¢˜

**é—®é¢˜**: `ValueError: æœªé…ç½® API Key`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ³• 1: ç¯å¢ƒå˜é‡
export DEEPSEEK_API_KEY="your_key"

# æ–¹æ³• 2: é…ç½®æ–‡ä»¶
# åœ¨ config.json ä¸­è®¾ç½® api.api_key
```

### 2. ä¸­æ–‡å­—ä½“æ˜¾ç¤ºé—®é¢˜

**é—®é¢˜**: ç”Ÿæˆçš„ PDF ä¸­æ–‡æ˜¾ç¤ºä¸ºæ–¹æ¡†

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Linux
sudo apt-get install fonts-wqy-microhei

# macOS (é€šå¸¸æ— éœ€æ“ä½œ)
# Windows (é€šå¸¸æ— éœ€æ“ä½œ)
```

### 3. ç¿»è¯‘è´¨é‡ä¸ä½³

**è§£å†³æ–¹æ¡ˆ**:
- è°ƒæ•´ `temperature` å‚æ•°ï¼ˆé™ä½åˆ° 0.1-0.3ï¼‰
- ä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡å‹ï¼ˆå¦‚ GPT-4ï¼‰
- å‡å° `chunk_size` ä»¥æä¾›æ›´å¤šä¸Šä¸‹æ–‡

### 4. API è°ƒç”¨è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- å¢åŠ  `retry_times` å’Œ `retry_delay`
- å‡å° `chunk_size` é™ä½å•æ¬¡è¯·æ±‚å¤§å°

### 5. å†…å­˜ä¸è¶³

**é—®é¢˜**: å¤„ç†å¤§å‹ PDF æ—¶å†…å­˜æº¢å‡º

**è§£å†³æ–¹æ¡ˆ**:
- å‡å° `chunk_size`
- å…³é—­ç¼“å­˜ (`cache_enabled: false`)
- åˆ†æ‰¹å¤„ç†æ–‡ä»¶

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—

```
pdf_translator/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pdf_parser.py       # PDF è§£ææ¨¡å—
â”‚   â”œâ”€â”€ translator.py       # AI ç¿»è¯‘å¼•æ“
â”‚   â”œâ”€â”€ pdf_generator.py    # PDF ç”Ÿæˆæ¨¡å—
â”‚   â””â”€â”€ batch_processor.py  # æ‰¹é‡å¤„ç†å™¨
â”œâ”€â”€ translate_pdfs.py       # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.json             # é…ç½®æ–‡ä»¶
â””â”€â”€ README.md               # ä½¿ç”¨æ–‡æ¡£
```

### æŠ€æœ¯æ ˆ

- **PDF å¤„ç†**: PyMuPDF (fitz), pdfplumber
- **AI é›†æˆ**: OpenAI SDK (å…¼å®¹ DeepSeek)
- **PDF ç”Ÿæˆ**: ReportLab
- **æ–‡æœ¬å¤„ç†**: æ­£åˆ™è¡¨è¾¾å¼ã€è‡ªç„¶æ®µè½åˆ†å‰²

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¹¶å‘å¤„ç†

è™½ç„¶æ”¯æŒå¹¶å‘ï¼Œä½†å»ºè®®è®¾ç½® `max_concurrent: 1` ä»¥é¿å… API é™æµã€‚

### 2. ç¼“å­˜ç­–ç•¥

å¯ç”¨ç¼“å­˜å¯ä»¥æ˜¾è‘—å‡å°‘é‡å¤ç¿»è¯‘çš„æˆæœ¬å’Œæ—¶é—´ã€‚

### 3. åˆ†å—å¤§å°

- è¾ƒå°çš„å—ï¼ˆ1500-2000ï¼‰ï¼šæ›´ç²¾ç¡®ï¼Œä½†è°ƒç”¨æ¬¡æ•°å¤š
- è¾ƒå¤§çš„å—ï¼ˆ3000-4000ï¼‰ï¼šæ›´å¿«ï¼Œä½†å¯èƒ½è¶…å‡º token é™åˆ¶

### 4. æˆæœ¬ä¼°ç®—

ä»¥ DeepSeek ä¸ºä¾‹ï¼š
- è¾“å…¥ï¼šÂ¥0.001 / 1K tokens
- è¾“å‡ºï¼šÂ¥0.002 / 1K tokens
- ä¸€ç¯‡ 10 é¡µè®ºæ–‡çº¦ 5000 è¯ï¼Œæˆæœ¬çº¦ Â¥0.05-0.10

## é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

### å½“å‰é™åˆ¶

1. **æ ¼å¼ä¿ç•™**: å¤æ‚çš„è¡¨æ ¼å’Œå¤šæ å¸ƒå±€å¯èƒ½æ— æ³•å®Œç¾ä¿ç•™
2. **å›¾ç‰‡å¤„ç†**: å›¾ç‰‡ä¸­çš„æ–‡å­—ä¸ä¼šè¢«ç¿»è¯‘
3. **å…¬å¼è¯†åˆ«**: ä»…æ”¯æŒ LaTeX æ ¼å¼çš„å…¬å¼è¯†åˆ«
4. **æ‰«æç‰ˆ PDF**: ä¸æ”¯æŒæ‰«æç‰ˆ PDFï¼ˆéœ€è¦ OCRï¼‰

### ä½¿ç”¨å»ºè®®

1. **å¤‡ä»½åŸæ–‡ä»¶**: ç¿»è¯‘å‰å»ºè®®å¤‡ä»½åŸå§‹ PDF
2. **æ£€æŸ¥ç»“æœ**: ç¿»è¯‘ååº”äººå·¥æ£€æŸ¥å…³é”®å†…å®¹
3. **ä¸“ä¸šæœ¯è¯­**: å¯¹äºç‰¹å®šé¢†åŸŸï¼Œå¯èƒ½éœ€è¦äººå·¥æ ¡å¯¹æœ¯è¯­ç¿»è¯‘
4. **ç‰ˆæƒæ³¨æ„**: ä»…ç”¨äºä¸ªäººå­¦ä¹ ç ”ç©¶ï¼Œä¸å¾—ç”¨äºå•†ä¸šç”¨é€”

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ç¿»è¯‘æç¤ºè¯

ç¼–è¾‘ `src/translator.py` ä¸­çš„ `_build_system_prompt()` æ–¹æ³•ï¼Œå¯ä»¥è‡ªå®šä¹‰ç¿»è¯‘é£æ ¼å’Œè¦æ±‚ã€‚

### æ”¯æŒå…¶ä»–è¯­è¨€

ä¿®æ”¹ `config.json` ä¸­çš„ `source_lang` å’Œ `target_lang`ï¼š

```json
{
  "translation": {
    "source_lang": "en",
    "target_lang": "ja"  // ç¿»è¯‘ä¸ºæ—¥æ–‡
  }
}
```

### é›†æˆåˆ°å·¥ä½œæµ

```bash
# å®šæ—¶ä»»åŠ¡ç¤ºä¾‹ï¼ˆæ¯å¤©å‡Œæ™¨ç¿»è¯‘æ–°è®ºæ–‡ï¼‰
0 0 * * * cd /path/to/pdf_translator && python translate_pdfs.py ~/papers/ >> cron.log 2>&1
```

## æ•…éšœæ’é™¤

### è°ƒè¯•æ¨¡å¼

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š

```bash
python translate_pdfs.py ./papers/ 2>&1 | tee debug.log
```

### æµ‹è¯•å•ä¸ªæ¨¡å—

```bash
# æµ‹è¯• PDF è§£æ
python src/pdf_parser.py test.pdf

# æµ‹è¯•ç¿»è¯‘å™¨
python src/translator.py

# æµ‹è¯• PDF ç”Ÿæˆ
python src/pdf_generator.py
```

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-10-23)

- âœ¨ é¦–æ¬¡å‘å¸ƒ
- âœ… æ”¯æŒæ‰¹é‡ PDF ç¿»è¯‘
- âœ… æ™ºèƒ½æ–‡æœ¬åˆ†å—
- âœ… å…¬å¼å’Œæ ¼å¼ä¿ç•™
- âœ… ç¼“å­˜å’Œæ–­ç‚¹ç»­ä¼ 
- âœ… æ”¯æŒ DeepSeek å’Œ OpenAI API

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®ï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
- å‘é€é‚®ä»¶

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼Happy Translating! ğŸ“šâœ¨**

